# Плагины КУН-IP8(4)
Рассматривается API для создания плагинов для концентраторов КУН-IP8(4).

## Введение
Плагины позволяют расширить функционал концентратора КУН-IP8(4).

Плагин представляет собой скрипт, написанный на языке LUA.

Вы можете написать плагин самостоятельно или обратиться за помошью в тех.поддержку компании [Текон-Автоматика](htts://www.tekon.ru)

В настоящий момент в КУН интегрированы следующие сторонние библиотеки:
- lua-basexx
- lua-binaryheap
- lua-bit32
- lua-cjson
- lua-cqueues
- lua-curl
- lua-fifo
- luafilesystem
- lua-http
- luajson
- lualogging
- lua-lpeg-patterns
- luaossl
- lua-periphery
- luaposix
- luasec
- luasocket
- lua-valua

## Формат плагинов
Файлы плагинов представляют собой tar архив, который опционально может быть запакован одной из программ-упаковщиков:
- bzip2
- xz
- lzip
- lzma
- gzip
- compress

К внутренней структуре архива предъявляется несколько требований:
1. в корне архива находится одна директория, имя которой является именем плагина; 
2. директория всегда содержит файл service.lua
3. директория может содержать файл config.lua (при наличии этого файла на странице плагинов в web-интерфейсе 
доступны дополнительные настройки данного плагина, которые и генерируются этим файлом);
4. все имена файлов и директорий чувствительны к регистру;
5. все имена файлов и директорий должны состоять только из символов кодовой таблицы US-ASCII, без использования пробела.

## Встроенная библиотека КУН-IP
Данная библиотека расширяет возможности интерпретатора LUA и позволяет управлять выбранными аппаратными ресурсами КУН-IP. 

В настоящий момент реализованы следущие функции:
-***cun.inputs_get()*** - возвращает таблицу с сопротивлениями (Ом) на всех "дискретных" входах КУН.
-***cun.buttons_get()*** - возвращает таблицу с состояниями всех кнопок "вызова" КУН. Значения 0 (неактивен) и 1 (активен).
-***cun.ext_temp_get()*** - возвращает таблицу с результатами измерения температуры (градусы Цельсия) всеми подключенными внешними датчиками.
-***cun.relays_get()*** - возвращает таблицу с состояниями всех имеющихся в КУН реле. Элементы таблицы принимают значения 0 (отключено) и 1 (включено).
-***cun.relay_set(index, state)*** - переключает реле index в состояние state.